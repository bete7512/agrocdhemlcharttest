apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
data:
  application-dashboard.json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "id": 1,
      "links": [],
      "panels": [
        {
          "title": "Backend Response Time",
          "type": "graph",
          "datasource": "Prometheus",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{service=\"backend\"}[5m])) by (le))",
              "legendFormat": "95th percentile"
            }
          ]
        },
        {
          "title": "Error Rate",
          "type": "graph",
          "datasource": "Prometheus",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m]))",
              "legendFormat": "Error Rate"
            }
          ]
        },
        {
          "title": "MongoDB Operations",
          "type": "graph",
          "datasource": "Prometheus",
          "targets": [
            {
              "expr": "rate(mongodb_op_counters_total[5m])",
              "legendFormat": "{{type}}"
            }
          ]
        }
      ],
      "refresh": "10s",
      "schemaVersion": 16,
      "style": "dark",
      "time": {
        "from": "now-6h",
        "to": "now"
      },
      "title": "Application Dashboard",
      "version": 0
    }